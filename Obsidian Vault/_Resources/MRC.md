#управление_памятью [[ARC]]
#многопоточность
Manual Reference Counting (MRC) — это ручное управление памятью, которое использовалось в Objective-C до введения Automatic Reference Counting (ARC). В режиме MRC программистам требовалось вручную управлять памятью, используя различные методы управления жизненным циклом объекта. Давайте рассмотрим этот механизм подробнее.

### Как работает MRC:

1. **Выделение памяти**: Когда создается новый объект, используется метод `alloc` для выделения памяти под этот объект.

2. **Инициализация**: После выделения памяти объект инициализируется соответствующим методом `init`.

3. **Увеличение счетчика ссылок**: Метод `retain` увеличивает счетчик ссылок объекта на 1. Каждый раз, когда вы хотите сохранить ссылку на объект, вы вызываете `retain`.

4. **Уменьшение счетчика ссылок**: Метод `release` уменьшает счетчик ссылок объекта на 1. Когда ссылка на объект больше не нужна, вы вызываете `release`.

5. **Освобождение памяти**: Если счетчик ссылок достигает нуля, объект уничтожается и память освобождается. 

6. **Прямое освобождение**: Метод `dealloc` вызывается, когда объект готов к удалению. Это позволяет объекту освободить любые ресурсы, которые он использует, перед тем, как память будет окончательно освобождена.

### Проблемы с MRC:

1. **Циклические ссылки**: Точно так же, как и в ARC, в MRC могут возникнуть проблемы с циклическими ссылками. Решение этой проблемы заключается в использовании слабых ссылок, которые не увеличивают счетчик ссылок.

2. **Ошибки управления памятью**: Один из основных недостатков MRC — это легкость допустить ошибку. Пропущенные вызовы `retain` или `release` могут привести к утечкам памяти или к освобождению объектов раньше времени, что в свою очередь может вызвать ошибки во время выполнения.

### Заключение:

MRC требует от программиста глубокого понимания жизненного цикла объектов и внимательного управления памятью. Ошибки управления памятью являются одной из наиболее частых причин сбоев в приложениях Objective-C на ранних этапах разработки. ARC был введен в качестве решения этой проблемы, предоставляя автоматическое управление памятью, что упрощает разработку и снижает риск ошибок связанных с памятью.